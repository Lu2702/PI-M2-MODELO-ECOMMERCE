# PROYECTO INTEGRADOR M2: MODELADO DE DATOS Y BASES DE DATOS RELACIONALES

## üß† Primer Avance ‚Äì Bases de datos relacionales

Esta primera pare del proyecto tiene como objetivo demostrar la configuraci√≥n, modelado e integraci√≥n de una base de datos relacional usando PostgreSQL y SQLAlchemy (ORM en Python), as√≠ como la limpieza y transformaci√≥n de los datos para futuras tareas anal√≠ticas. Este README explica paso a paso c√≥mo replicar el proyecto, su estructura y justificaci√≥n de cada componente.

Lo siguiente descrito corresponde al **primer avance**, en el cual se establecen las bases del modelado, integraci√≥n de datos y una exploraci√≥n. En futuras etapas se integrar√°n nuevas herramientas y funcionalidades.

---

## üåê Configuraci√≥n del Entorno de Trabajo

### 1. Requisitos previos

* Tener instalado:

  * Python >= 3.9
  * Docker y Docker Compose

### 2. Levantar la infraestructura con Docker

La conexi√≥n a la base de datos y a las herramientas auxiliares (DBT, PgAdmin, Streamlit) se realiza a trav√©s de contenedores Docker definidos en los siguientes archivos:

* `docker-compose.yml`: Define los servicios de PostgreSQL, PgAdmin, DBT y Streamlit.
* `Dockerfile`: Configura la imagen base para DBT y Streamlit.
* `.env`: Contiene las variables sensibles necesarias para la configuraci√≥n.

### 3. Variables de entorno (.env)

Crea un archivo ubicado en `mi_proyecto_pg/.env`, que contenga:

- ‚ö†Ô∏è Importante: El archivo .env no est√° incluido por seguridad. Usa .env.example como plantilla y reemplaza con tus valores reales. Este archivo define las credenciales necesarias para conectarse a PostgreSQL y acceder a PgAdmin desde http://localhost:8080.

```
# Variables para PostgreSQL
POSTGRES_DB=postgres
POSTGRES_USER=admin
POSTGRES_PASSWORD=admin123

# Variables para PgAdmin (REEMPLAZAR con tus datos reales)
PGADMIN_DEFAULT_EMAIL=tu_correo@ejemplo.com
PGADMIN_DEFAULT_PASSWORD=tu_contrase√±a_pgadmin
```

### 4. Levantar los contenedores

Desde la terminal, en la carpeta donde est√° el `docker-compose.yml`:

```bash
docker-compose up --build -d
```

Esto crea y levanta:

* Una base de datos PostgreSQL
* Un PgAdmin accesible desde `http://localhost:8080`
* Un contenedor con DBT
* Un contenedor con Streamlit (usado en fases posteriores)

---

## üìÅ Estructura del Proyecto

```
mi_proyecto_pg/
‚îú‚îÄ‚îÄ .env                         # Variables para PostgreSQL y PgAdmin
‚îú‚îÄ‚îÄ Dockerfile                   # Imagen para contenedor DBT
‚îú‚îÄ‚îÄ docker-compose.yml          # Orquestaci√≥n de servicios Docker
‚îú‚îÄ‚îÄ PRIMER AVANCE/              # ETL, ORM, scripts, modelo
‚îÇ   ‚îú‚îÄ‚îÄ db_conector.py
‚îÇ   ‚îú‚îÄ‚îÄ modelos.py
‚îÇ   ‚îú‚îÄ‚îÄ crear_tablas.py
‚îÇ   ‚îú‚îÄ‚îÄ 1.importar_usuarios.py
‚îÇ   ‚îú‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ exploracion.ipynb        # se explica m√°s adelante
‚îÇ   ‚îî‚îÄ‚îÄ DATA M2/                 # scripts .sql para extraer los datos
‚îÇ       ‚îú‚îÄ‚îÄ 2.usuarios.sql
‚îÇ       ‚îú‚îÄ‚îÄ 3.categorias.sql
‚îÇ       ‚îú‚îÄ‚îÄ 4.Productos.sql
‚îÇ       ‚îú‚îÄ‚îÄ 5.ordenes.sql
‚îÇ       ‚îú‚îÄ‚îÄ 6.detalle_ordenes.sql
‚îÇ       ‚îú‚îÄ‚îÄ 7.direcciones_envio.sql
‚îÇ       ‚îú‚îÄ‚îÄ 8.carrito.sql
‚îÇ       ‚îú‚îÄ‚îÄ 9.metodos_pago.sql
‚îÇ       ‚îú‚îÄ‚îÄ 10.ordenes_metodospago.sql
‚îÇ       ‚îú‚îÄ‚îÄ 11.resenas_productos.sql
‚îÇ       ‚îî‚îÄ‚îÄ 12.historial_pagos.sql
```

---

## üöÄ Paso a Paso para Ejecutar el Proyecto

### Paso 1: Crear las tablas con ORM

El archivo `crear_tablas.py` ejecuta el siguiente flujo:

1. Importa el motor de conexi√≥n (`get_db_engine`) y el modelo base `Base` desde `db_conector.py`.
2. Importa todas las clases ORM desde `modelos.py` (Usuarios, Categorias, Productos, etc.).
3. Llama a `Base.metadata.create_all(bind=engine)` para crear todas las tablas en la base de datos conectada.
4. Imprime en consola un mensaje de √©xito o error.

Este enfoque asegura que las tablas est√©n definidas de manera centralizada y coherente con las clases Python del ORM.

**Justificaci√≥n**:

* Evita errores manuales en definiciones SQL.
* Permite validar y reutilizar las estructuras en cualquier parte del c√≥digo.
* Es ideal para entornos escalables y mantenibles.

### Paso 2: Importaci√≥n de datos desde archivos `.sql`

Los scripts como `1.importar_usuarios.py` utilizan expresiones regulares para extraer las sentencias `INSERT INTO` desde archivos `.sql` como `DATA M2/2.usuarios.sql`. Luego:

1. Se limpia el texto (por ejemplo, eliminando acentos).
2. Se separan los valores dentro del `VALUES (...)`.
3. Se insertan fila por fila como objetos ORM en la base de datos usando `session.add()` y `session.commit()`.

**Ventajas de este enfoque**:

* Se validan tipos, claves primarias y restricciones al momento de la inserci√≥n.

### Paso 3: Verificaci√≥n en PgAdmin

Una vez cargados los datos, se puede abrir `http://localhost:8080`, iniciar sesi√≥n en PgAdmin con las credenciales del archivo `.env`, y:

* Explorar visualmente las tablas creadas por SQLAlchemy.
* Navegar por los datos cargados desde los archivos `.sql`.
* Realizar queries manuales para validaci√≥n y an√°lisis preliminar.

Esta visualizaci√≥n es clave para asegurar que los datos est√°n correctos, y para preparar futuros KPIs o modelos anal√≠ticos.

---

Esta parte del primer avance ya cuenta con:

* Base de datos relacional operativa en Docker.
* Tablas generadas autom√°ticamente v√≠a ORM.
* Datos cargados desde archivos `.sql` por scripts ETL personalizados.
* Validaci√≥n visual mediante PgAdmin.

Con esta base, el proyecto est√° listo para avanzar hacia la exploraci√≥n de los datos.

## üìä An√°lisis Exploratorio y Evaluaci√≥n de Calidad de Datos

El an√°lisis exploratorio se realiz√≥ en el archivo `exploracion.ipynb`, utilizando una combinaci√≥n de SQL, SQLAlchemy y herramientas gr√°ficas en Python como pandas, seaborn y matplotlib.

### üîç Paso a paso del archivo `exploracion.ipynb`

1. **Conexi√≥n a la base de datos**:

   * Se importa el engine desde `db_conector.py`
   * Se valida la conexi√≥n exitosa

2. **Creaci√≥n de sesi√≥n SQLAlchemy**:

   * Se crea una sesi√≥n con `sessionmaker()` para consultas ORM

3. **Carga de datos v√≠a SQL**:

   * Se utiliza `pd.read_sql()` para obtener datos con consultas SQL
   * Se cargan tablas como `Usuarios`, `Productos`, `Carrito`, `Rese√±asProductos`, `HistorialPago`

4. **Evaluaci√≥n de calidad de datos**:

   * `df.isnull().sum()` para detectar nulos
   * `df.duplicated() para verificar duplicados
   * Validaci√≥n de campos como emails (`@`) y precios no negativos

5. **Visualizaciones de distribuci√≥n y comportamiento**:

   * Distribuci√≥n de calificaciones
   * Intenci√≥n de compra por mes (carrito)
   * M√©todos de pago m√°s usados
   * Monto pagado por mes registrado en el historial

6. **Extracci√≥n de insights relevantes**:

   * Producto con m√°s unidades agregadas al carrito
   * Top usuarios por ingreso
   * Productos m√°s costosos y con m√°s stock

---

### ‚úÖ Verificaciones de Calidad

Se aplicaron revisiones sistem√°ticas para garantizar la calidad e integridad de los datos:

* **Valores nulos**: Se us√≥ `df.isnull().sum()` para cada tabla. **No se detectaron valores nulos** en ninguna columna clave.
* **Duplicados**: Se utiliz√≥ `df.duplicated()` y se confirm√≥ que **no exist√≠an registros duplicados**.
* **Formato de correos electr√≥nicos**: Se valid√≥ que todas las entradas en `Email` contuvieran el car√°cter `@`.
* **Valores at√≠picos**: Se inspeccionaron columnas como `Cantidad`, `Stock` y `MontoPagado` con estad√≠sticos y boxplots.

> ‚úÖ Resultado: **Los datos est√°n en buen estado**, sin errores estructurales ni referenciales, y son adecuados para an√°lisis, visualizaci√≥n y modelado posterior.

---

## üìå Hallazgos Clave e Insights del An√°lisis Exploratorio

### üéØ Producto con mayor intenci√≥n de compra

* **ProductoID 25** fue el que m√°s veces se agreg√≥ al carrito: **338 unidades**.

### üë§ Top 5 usuarios con mayor ingreso generado (ordenes Completadas):

| UsuarioID | Ingreso Total USD |
| --------- | ----------------- |
| 112       | \$5,111.83        |
| 411       | \$4,905.19        |
| 703       | \$4,424.94        |
| 390       | \$4,104.38        |
| 667       | \$4,057.64        |

Esto permite identificar a usuarios de alto valor para posibles estrategias de fidelizaci√≥n o segmentaci√≥n personalizada.

### üí∞ Top 5 productos m√°s caros del cat√°logo

| Producto                   | Precio Unitario USD |
| -------------------------- | ------------------- |
| Laptop Dell Inspiron 15    | \$799.00            |
| Consola PlayStation 5      | \$549.99            |
| Smartphone Galaxy A54      | \$349.99            |
| Bicicleta Monta√±a Aro 29   | \$299.00            |
| Auriculares Bluetooth Sony | \$129.99            |

La tabla muestra que los productos m√°s caros del cat√°logo pertenecen principalmente a la categor√≠a de tecnolog√≠a y tienen un alto valor unitario. Implementar una secci√≥n en el e-commerce que recomiende productos complementarios cuando el usuario visualice o agregue al carrito uno de los productos premium.

### üì¶ Top 5 productos con m√°s inventario disponible

| Producto                    | Unidades en Stock |
| --------------------------- | ----------------- |
| Cuaderno Universitario 100h | 300               |
| Alcohol en Gel 500ml        | 200               |
| Camiseta B√°sica Hombre      | 200               |
| Crema Hidratante Facial     | 150               |
| Jeans Skinny Mujer          | 150               |

Esta informaci√≥n es clave para estrategias de rotaci√≥n de stock y campa√±as de liquidaci√≥n.
Lanzar una campa√±a de promoci√≥n o liquidaci√≥n dirigida a estos productos para acelerar su salida del inventario.

### üë• Total de usuarios registrados

* Se detectaron **1,000 usuarios √∫nicos**, lo que indica una buena base de clientes para an√°lisis de comportamiento.

---

## üìà Visualizaciones destacadas

* **Monto total pagado por mes**: El mes **abril** (4) fue el de mayor ingreso total con **\$469,415.61**.
* **Distribuci√≥n de calificaciones**: Las evaluaciones est√°n distribuidas de manera relativamente uniforme entre 1 y 5 estrellas.
* **M√©todos de pago m√°s utilizados**: Se observa una distribuci√≥n balanceada entre todas las formas de pago, con ligera preferencia por ‚ÄúCr√©dito en tienda‚Äù.
* **Intenci√≥n de compra**: Las unidades agregadas al carrito aumentaron en el mes 5, lo cual podr√≠a asociarse a promociones o estacionalidad.

Estas visualizaciones se encuentran documentadas y generadas autom√°ticamente dentro del cuaderno `exploracion.ipynb`.

---

Con esta informaci√≥n, el proyecto concluye el **primer avance** con:

* Datos estructurados, cargados y validados
* Tablas limpias y sin inconsistencias
* An√°lisis exploratorio completo
* Hallazgos relevantes para futuras decisiones de negocio y modelado avanzado

## üß† Segundo Avance ‚Äì Modelado de Datos Dimensional

## üìÅ Estructura del Proyecto

```
MI_PROYECTO_PG/
‚îÇ
‚îú‚îÄ‚îÄ PROYECTO M2/
‚îÇ   ‚îú‚îÄ‚îÄ PRIMER AVANCE/
‚îÇ   ‚îî‚îÄ‚îÄ SEGUNDO AVANCE/
‚îÇ       ‚îú‚îÄ‚îÄ Conc_Carrito.drawio.png
‚îÇ       ‚îú‚îÄ‚îÄ Conc_DetalleOrdenes.drawio.png
‚îÇ       ‚îú‚îÄ‚îÄ Conc_Ordenes.drawio.png
‚îÇ       ‚îú‚îÄ‚îÄ Conc_OrdenesMetodosPago.drawio.png
‚îÇ       ‚îú‚îÄ‚îÄ Diagrama_ER.drawio.png
‚îÇ       ‚îú‚îÄ‚îÄ Log_Carrito.drawio.png
‚îÇ       ‚îú‚îÄ‚îÄ Log_DetalleOrdenes.drawio.png
‚îÇ       ‚îú‚îÄ‚îÄ Log_Ordenes.drawio.png
‚îÇ       ‚îú‚îÄ‚îÄ Log_OrdenesMetodosPago.drawio.png
‚îÇ       ‚îî‚îÄ‚îÄ segundo_avance.ipynb
```

### üîç PI 1: An√°lisis de negocio y descubrimiento de requisitos

* Analizar las preguntas de negocio a la luz de los datos presentados en el punto anterior.
* Entender qu√© quiere resolver el negocio y qu√© datos est√°n disponibles para ello.

Los stakeholders han definido las siguientes preguntas clave que reflejan las prioridades estrat√©gicas del negocio:

1. **¬øCu√°l es la tasa de conversi√≥n de usuarios que agregan productos al carrito y concretan una compra?**
2. **¬øCu√°l es el ingreso generado por mes y el ingreso total acumulado?**
3. **¬øQu√© categor√≠a de producto presenta mayores ingresos?**
4. **¬øQu√© usuario genera los mayores ingresos?**
5. **¬øCu√°l es la tasa de cancelaci√≥n de √≥rdenes de compra?**

---

### üìÄ PI 2: Identificaci√≥n de componentes del modelo dimensional

#### ‚úÖ Hechos (medidas)

| Acci√≥n            | Hecho (Tabla de Hechos) | Medidas                  |
| ----------------- | ----------------------- | ------------------------ |
| Agregar a carrito | Carrito                 | Cantidad                 |
| Pedidos           | Ordenes                 | Total                    |
| Orden de compra   | DetalleOrdenes          | Cantidad, PrecioUnitario |
| Montos pagados    | OrdenesMetodosPago      | MontoPagado              |

#### üåü Dimensiones

| Dimensi√≥n   | Relaci√≥n                                                                |
| ----------- | ----------------------------------------------------------------------- |
| Usuarios    | Cu√°l de los usuarios realiza las compras, pagos, agrega a carrito, etc. |
| Productos   | Qu√© productos se venden o se abandonan                                  |
| Categor√≠as  | A qu√© categor√≠a pertenecen los productos                                |
| MetodosPago | Informaci√≥n sobre m√©todos de pago                                       |

---

### üß± PI 3: Dise√±o del modelo de datos

* Se model√≥ una arquitectura dimensional tipo estrella siguiendo la metodologia kimball para consultas eficientes.
* Se elaboraron los siguientes diagramas:

  * `Diagrama_ER.drawio.png` (diagrama general entidad-relaci√≥n).
  * `Conc_*.drawio.png`: esquemas conceptuales por tabla.
  * `Log_*.drawio.png`: esquemas l√≥gicos por tabla.

---

### üîÄ PI 4: Slowly Changing Dimensions (SCDs)

#### Tipo 2 (mantiene historial):

* `Usuarios`: Cambios en nombre, apellido, dni, email.
* `Productos`: Cambios en precio.
* `MetodosPago`: Cambios en nombre.

#### Tipo 1 (sobrescribe):

* `Categor√≠as`: Cambios en nombre o descripcion.

---

### üìü PI 5: Documentaci√≥n y justificaci√≥n del modelo

* El modelo est√° alineado a las necesidades del negocio.
* Las tablas de hechos agrupan informaci√≥n clave para las m√©tricas.
* Las dimensiones permiten filtros y segmentaciones ricas para an√°lisis.
* El uso de SCD garantiza trazabilidad temporal donde es necesario.

üìé Archivos relacionados:

* üìò Notebook: `segundo_avance.ipynb`
* üìä Diagramas ER y por tabla: `Conc_*.drawio.png`, `Log_*.drawio.png`, `Diagrama_ER.drawio.png`

# üìä Tercer Avance - Proyecto DBT E-commerce

Este repositorio contiene una **versi√≥n limpia y desacoplada** del modelo dimensional para un sistema de e-commerce, dise√±ado con DBT, integrado con PostgreSQL y preparado para visualizaci√≥n en Streamlit.

> ‚ö†Ô∏è Esta versi√≥n fue renombrada para evitar conflictos con contenedores existentes. Sigue cuidadosamente los pasos para que puedas ejecutarlo desde cero.

---

## üß± Estructura del Proyecto `TERCER AVANCE DBT/`

```
TERCER AVANCE DBT/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ ecommerce_project/
‚îÇ       ‚îú‚îÄ‚îÄ dbt_project_copia.yml        # ‚Üê Renombrar a dbt_project.yml
‚îÇ       ‚îú‚îÄ‚îÄ models/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ bronze/                  # Archivos de staging
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ silver/                  # Transformaciones intermedias
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ gold/                    # M√©tricas, KPIs y vistas finales
‚îÇ       ‚îú‚îÄ‚îÄ snapshots/                   # Para Slowly Changing Dimensions
‚îÇ
‚îú‚îÄ‚îÄ dbt_profiles/
‚îÇ   ‚îî‚îÄ‚îÄ profiles_copia.yml               # ‚Üê Renombrar a profiles.yml
```

---

## üîÅ Pasos para replicar el proyecto

1. **Clona el repositorio** o copia manualmente la carpeta `TERCER AVANCE DBT/`.

2. **Renombra los archivos necesarios:**

   | Archivo/Carpeta Actual                        | Renombrar como    |
   | --------------------------------------------- | ----------------- |
   | `app/ecommerce_project/dbt_project_copia.yml` | `dbt_project.yml` |
   | `dbt_profiles/profiles_copia.yml`             | `profiles.yml`    |

3. **Abre la terminal y navega al directorio del proyecto:**

```bash
cd app/ecommerce_project
```

4. **Verifica la conexi√≥n y la configuraci√≥n del entorno DBT:**

```bash
dbt debug
```

5. **Ejecuta los modelos en orden:**

```bash
dbt run
```
---

## ‚öôÔ∏è Configuraci√≥n del Perfil DBT (`profiles.yml`)

Este archivo debe colocarse en la carpeta `dbt_profiles/`. Contiene las credenciales necesarias para conectarse al contenedor de PostgreSQL:

```yaml
ecommerce_project:
  target: dev
  outputs:
    dev:
      type: postgres
      host: db
      user: admin
      password: admin123
      port: 5432
      dbname: EcommerceDB
      schema: public
      threads: 4
```
## üí™ Paso a paso: Implementaci√≥n en DBT

### 1. **Modelo Bronze (Staging)**

* Se importaron las tablas brutas desde PostgreSQL utilizando `source.yml`.
* Se crearon archivos `.sql` por cada tabla (e.g., `stg_usuarios.sql`, `stg_productos.sql`).
* En esta capa no se alteran los datos, s√≥lo se renombran columnas, se manejan nulos evidentes y se normaliza formato.

### 2. **Modelo Silver (Modelo dimensional)**

* Se definieron dimensiones y hechos:

  * `dim_usuarios`, `dim_productos`, `dim_metodos_pago`, `dim_categorias`
  * `fct_carrito`, `fct_ordenes`, `fct_detalleordenes`, `fct_ordenes_metodos_pago`
* Se implementaron relaciones entre tablas mediante claves for√°neas.

### 3. **üîÑ Implementaci√≥n de Slowly Changing Dimensions (SCD)**

En este proyecto se definieron algunas dimensiones como SCD tipo 2 (Usuarios, M√©todos de Pago, Productos) y tipo 1 (Categorias). Sin embargo, **durante este avance**, como a√∫n no se hab√≠an producido cambios reales en las fuentes, la estructura generada fue la siguiente:

```sql
current_timestamp AS "FechaInicio",
NULL AS "FechaFin",
TRUE AS "Activo"
```

> Esto se realiz√≥ para simular el comportamiento de SCD hasta que se detectaran cambios.

Una vez existan cambios y se activen los snapshots, se deber√° modificar a:

```sql
dbt_valid_from AS "FechaInicio",
dbt_valid_to AS "FechaFin",
dbt_current_flag AS "Activo"
```

Y tambi√©n el `generate_surrogate_key` deber√° incluir `"dbt_valid_from"` como parte del hash:

```sql
{{ dbt_utils.generate_surrogate_key(["MetodoPagoID", "dbt_valid_from"]) }} AS MetodoPagoSK
```

---

### 4. **Modelo Gold (KPIs e insights)**

* Se construyeron modelos agregados para responder las preguntas de negocio:

  * Ingreso mensual y acumulado
  * Tasa de conversi√≥n de carrito a compra
  * Tasa de cancelaci√≥n de √≥rdenes
  * Ingreso total por usuario
  * Ingreso total por categor√≠a de producto

---

## üß¨ Storytelling: Insights Clave del Negocio

> üîç A partir de los KPIs definidos, el modelo arroja resultados que permiten tomar decisiones estrat√©gicas:

### 1. üåê Tasa de conversi√≥n

* De los 996 usuarios que agregaron productos al carrito, 990 realizaron una compra.
* **Tasa de conversi√≥n: 99.4%**. Esto indica una experiencia de usuario eficiente

### 2. üìà Ingreso acumulado por mes

* Se observa un crecimiento sostenido en los ingresos:
* **Ingreso total acumulado: \$2,752,410.34**.
* Durante el an√°lisis de los ingresos mensuales del e-commerce, se identificaron tres meses clave con picos de ingresos:

- Agosto 2024 ($ 249,113.38)
- Abril 2025 ($ 242,874.59)
- Diciembre 2024 ($ 231,544.10)

Estos hallazgos permiten dise√±ar campa√±as m√°s agresivas en temporadas clave, mejorar la log√≠stica en esos meses y anticiparse con estrategias de marketing estacional

### 3. üèß Tasa de cancelaci√≥n

* De 10,000 √≥rdenes generadas, 2,510 fueron canceladas.
* **Tasa de cancelaci√≥n: 25.1%**, una cifra que merece investigaci√≥n y acci√≥n para reducirla.

### 4. üß± Usuarios con mayores ingresos

* Usuarios como **Marcia**, **Juan Jos√©** y **Samu** han generado m√°s de \$7,700 en ingresos individuales.
* Esto permite personalizar promociones para clientes premium.

### 5. üõçÔ∏è Categor√≠as m√°s rentables

* Las categor√≠as con mayor ingreso:

  * **Tecnolog√≠a y Gadgets**
  * **Juguetes y Juegos**
  * **Videojuegos**
* Esto justifica estrategias de stock y publicidad dirigidas a esas categor√≠as.

---

## üîç Conclusi√≥n

El modelo dimensional implementado con DBT permite un acceso estructurado, limpio y eficiente a los datos del e-commerce, respondiendo preguntas de negocio de forma directa y fundamentada.
‚úÖ Este avance marca la consolidaci√≥n del modelo f√≠sico y su capacidad para responder a las preguntas de negocio planteadas, sentando la base para el dashboard final en el cuarto avance.

> En el siguiente avance se documentar√° el modelo con `dbt docs` y se integrar√° la visualizaci√≥n con **Streamlit**.

# üì¶ Cuarto Avance DBT + Streamlit

En este cuarto avance se abordan las etapas PI1, PI2 y PI3, enfocadas en la implementaci√≥n de tests autom√°ticos para validar la integridad de los datos, la generaci√≥n de documentaci√≥n t√©cnica navegable con DBT, y la presentaci√≥n visual de hallazgos clave mediante t√©cnicas de storytelling con datos.

---

## üß± Estructura del Proyecto 
```
.
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îú‚îÄ‚îÄ silver/
‚îÇ   ‚îú‚îÄ‚îÄ marts/
‚îÇ   ‚îî‚îÄ‚îÄ snapshots/
‚îú‚îÄ‚îÄ snapshots/
‚îú‚îÄ‚îÄ streamlit/
‚îÇ   ‚îú‚îÄ‚îÄ app.py
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ dbt_project.yml
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md
```
---
## Validaci√≥n y Optimizaci√≥n con DBT 

### Tests autom√°ticos

Se implementaron los siguientes tests de integridad en los archivos `schema.yml`:

- **not_null** y **unique** en claves primarias (`UsuarioID`, `ProductoID`, etc.).
- **relationships** para claves for√°neas como `"CategoriaID"` en la tabla Productos:
ejemplo
```yml
- name: '"CategoriaID"'
  description: Categor√≠a a la que pertenece cada producto
  tests: 
    - not_null
    - relationships:
        to: source('src', 'Categorias')
        field: '"CategoriaID"'
```
‚úÖ Validaci√≥n de Datos con Tests Autom√°ticos en DBT
Los tests son una herramienta esencial para asegurar la calidad de los datos y garantizar relaciones correctas entre tablas.

üß™ Tipos de tests implementados:

not_null: Verifica que los campos clave como IDs no contengan valores nulos.

unique: Asegura unicidad en identificadores.

relationships: Comprueba la integridad referencial entre claves primarias y for√°neas.

üìÇ Implementaci√≥n:
Todos los tests est√°n definidos en los archivos schema.yml 

‚ñ∂Ô∏è Ejecuci√≥n:

Para correr todos los tests autom√°ticos definidos en el proyecto:

```bash
dbt test
```
---

### Materializaciones

Se experiment√≥ con distintas materializaciones (`view`, `table`, `incremental`). Se opt√≥ por:

- `view` para modelos de bronze.
- `table` para modelos silver y gold

## Documentaci√≥n Interactiva con DBT 

La documentaci√≥n fue generada con:

```bash
dbt docs generate
dbt docs serve --port 8080 --host¬†0.0.0.0
```
### üß≠ Visualizaci√≥n del Flujo de Modelos y KPIs (DBT Docs)

A continuaci√≥n se presentan diagramas exportados desde DBT Docs, los cuales muestran c√≥mo fluye la transformaci√≥n de datos desde las fuentes (src) hasta los KPIs construidos en el modelo dimensional.

Estos gr√°ficos evidencian la trazabilidad, dependencias y arquitectura modular implementada en el proyecto.

üîπ KPI: Categor√≠a con Mayor Ingreso

<p align="center">
  <img src="docs/kpi_categoria_mayor_ingreso.png" width="700"/>
  <br><em>Figura 1. Trazabilidad del KPI de categor√≠a con mayor ingreso</em>
</p>

üîπ KPI: Ingresos Mensuales

<p align="center"> <img src="docs/kpi_ingresos_mensuales.png" width="700"/> <br><em>Figura 2. Flujo de modelos para calcular los ingresos mensuales</em> </p>

üîπ KPI: Tasa de Cancelaci√≥n

<p align="center"> <img src="docs/kpi_tasa_cancelacion.png" width="700"/> <br><em>Figura 3. Pipeline del KPI de tasa de cancelaci√≥n</em> </p>

üîπ KPI: Tasa de Conversi√≥n desde Carrito

<p align="center"> <img src="docs/kpi_tasa_conversion_carrito.png" width="700"/> <br><em>Figura 4. Relaci√≥n entre carritos y √≥rdenes para tasa de conversi√≥n</em> </p>

üîπ KPI: Usuario con Mayor Ingreso

<p align="center"> <img src="docs/kpi_usuario_mayor_ingreso.png" width="700"/> <br><em>Figura 5. Estructura de modelos para identificar al usuario con mayor ingreso</em> </p>

---

## Visualizaci√≥n y Storytelling con Streamlit (PI3)

### Descripci√≥n de la app

La visualizaci√≥n se desarrolla con Streamlit usando PostgreSQL como backend. El archivo `app.py` realiza la conexi√≥n, consulta KPIs y despliega gr√°ficas interactivas.

#### Construcci√≥n del contenedor

Con el `Dockerfile` se ejecuta la app v√≠a:

```bash
docker build -t streamlit_app .
docker run -p 8501:8501 streamlit_app
```

#### Requisitos

Archivo `requirements.txt`:

```
streamlit
psycopg2-binary
pandas
plotly
```

---

## KPIs Visualizados

| KPI                            | Detalle |
|-------------------------------|---------|
| Categor√≠a con m√°s ingreso     | üèÜ Tecnolog√≠a y Gadgets, con m√°s de \$353,783 |
| Ingresos mensuales            | Crecimiento sostenido; acumulado > \$2.7M |
| Tasa de cancelaci√≥n           | 25.1%, lo que indica oportunidades de mejora |
| Tasa de conversi√≥n            | Alta eficiencia con 99.4% de usuarios con carrito que compran |
| Usuarios con mayores ingresos | Top 5 usuarios generaron m√°s de \$37,000 en ingresos |

---

## Storytelling: Hallazgos clave

üìñ Storytelling: Hallazgos Clave del Negocio
Los an√°lisis realizados a partir del modelo dimensional y visualizados en el dashboard de Streamlit permiten identificar patrones relevantes que impactan directamente en la estrategia comercial de la tienda:

üèÜ 1. Tecnolog√≠a domina en ingresos
La categor√≠a Tecnolog√≠a y Gadgets lidera las ventas con $353,783 generados. Este comportamiento sugiere una clara preferencia del mercado por productos tecnol√≥gicos, lo cual representa una oportunidad de expansi√≥n del cat√°logo y ofertas dirigidas a este segmento.

<p align="center"> <img src="docs/kpi_categoria_mayor_ingreso_tabla.png" width="1000"/> <br><em>Figura A. Tabla con ingresos por categor√≠a</em> </p> <p align="center"> <img src="docs/kpi_categoria_mayor_ingreso_grafico.png" width="1000"/> <br><em>Figura B. Gr√°fico de barras: ingreso total por categor√≠a</em> </p>

üìà 2. Tendencia positiva de ingresos mensuales
Los ingresos muestran un crecimiento sostenido mes a mes, con un acumulado que supera los $2.7 millones. Esta evoluci√≥n sugiere una adopci√≥n creciente del canal digital, y permite proyectar escenarios de demanda futura. Se recomienda reforzar las estrategias actuales de marketing digital y promociones mensuales.

<p align="center"> <img src="docs/kpi_ingresos_mensuales_tabla.png" width="1000"/> <br><em>Figura C. Tabla de ingresos mensuales por mes</em> </p> <p align="center"> <img src="docs/kpi_ingresos_mensuales_grafico.png" width="1000"/> <br><em>Figura D. Gr√°fico de l√≠neas con ingreso mensual y acumulado</em> </p>

üõçÔ∏è 3. Conversi√≥n casi perfecta
La tasa de conversi√≥n es excepcional: el 99.4% de los usuarios que agregan productos al carrito en estado "Completo" y "Enviado" y completan su compra. Este dato evidencia que la experiencia de usuario. Es clave mantener esta eficiencia y evitar cambios dr√°sticos en la interfaz que puedan romper este flujo.

<p align="center"> <img src="docs/kpi_tasa_cancelacion_tabla.png" width="1000"/> <br><em>Figura E. Tabla que muestra el n√∫mero de √≥rdenes y cancelaciones</em> </p> <p align="center"> <img src="docs/kpi_tasa_cancelacion_grafico.png" width="1000"/> <br><em>Figura F. Visualizaci√≥n de la tasa de cancelaci√≥n vs √≥rdenes completadas</em> </p>

‚ùó 4. Riesgo latente en cancelaciones
Con una tasa de cancelaci√≥n del 25.1%, existe una alerta operativa: 1 de cada 4 pedidos confirmados es cancelado posteriormente. Este dato puede deberse a problemas log√≠sticos, falta de stock o errores en medios de pago. Se recomienda auditar el proceso post-venta para identificar y atacar las causas ra√≠z.

<p align="center"> <img src="docs/kpi_tasa_conversion_carrito_tabla.png" width="1000"/> <br><em>Figura G. Tabla que incluye usuarios con carritos creados y con √≥rdenes realizadas, finalmente cual es el porcentaje de conversi√≥n </em> </p> <p align="center"> <img src="docs/kpi_tasa_conversion_carrito_grafico.png" width="1000"/> <br><em>Figura H. Visualizaci√≥n del porcentaje de conversi√≥n desde carrito a compra</em> </p>

üéØ 5. Concentraci√≥n de ingresos en pocos usuarios
El top 5 de usuarios concentra m√°s de $37,000 en ingresos, lo que representa una oportunidad para implementar programas de fidelizaci√≥n, membres√≠as premium o beneficios exclusivos que fomenten la recurrencia y retenci√≥n de estos clientes clave.

<p align="center"> <img src="docs/kpi_usuario_mayor_ingreso_tabla.png" width="1000"/> <br><em>Figura I. Tabla con los usuarios que generan mayor ingreso</em> </p> <p align="center"> <img src="docs/kpi_usuario_mayor_ingreso_grafico.png" width="1000"/> <br><em>Figura J. Gr√°fico de barras con ingresos por usuario</em> </p>

---

Autor: Guadalupe Ramirez  
Bootcamp Data Engineer





